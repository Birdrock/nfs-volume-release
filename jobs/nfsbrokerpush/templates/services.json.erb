<%=
  config = []
  p("nfsbrokerpush.services").each do |service|
    plans = []
    service["plans"].each do |plan|
      plans << {
        "id":plan["id"],
        "name": plan["name"],
        "description": plan["description"],
        "metadata": {
          "costs": plan["metadata"]["costs"],
          "displayName": plan["metadata"]["display_name"]
        }
      }
    end

    config << {
      "id": service["id"],
      "name": service["name"],
      "description": service["description"],
      "bindable": service["bindable"],
      "plan_updateable": service["plan_updatable"],
      "tags": service["tags"],
      "plans": plans,
      "requires": service["requires"],
      "metadata": {
        "displayName": service["metadata"]["display_name"],
        "imageUrl": service["metadata"]["image_url"],
        "longDescription": service["metadata"]["long_description"],
        "providerDisplayName": service["metadata"]["provider_display_name"],
        "documentationUrl": service["metadata"]["documentation_url"]
      }
    }
  end

  require 'json'
  JSON.dump(config)
%>
